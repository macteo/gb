<% item = "venue" %>
<div class="row">
    <div class="col-md-7">
        <%= form_for([@club, @venue]) do |f| %>
          <% if @venue.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@venue.errors.count, "error") %> prohibited this venue from being saved:</h2>

              <ul>
              <% @venue.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
              </ul>
            </div>
          <% end %>

          <div class="field">
            <%= f.label "Nome" %><br>
            <%= f.text_field :name, :size => "90" %>
          </div>
          <div class="field">
            <%= f.label "Indirizzo" %><br>
            <%= f.text_field :address, :size => "90" %>
          </div>
          <div class="field">
            <%= f.label "Latitudine" %><br>
            <%= f.text_field :latitude %>
          </div>
          <div class="field">
            <%= f.label "Longitudine" %><br>
            <%= f.text_field :longitude %>
          </div>
          <div class="field">
            <%= f.label "Categoria" %><br>
            <%= f.number_field :category %>
          </div>
          <div class="field">
            <%= f.label "Telefono" %><br>
            <%= f.text_field :telephone %>
          </div>
          <div class="field">
            <%= f.label "Chiusura" %><br>
            <%= f.text_field :closed, :size => "90" %>
          </div>
          <div class="field">
            <%= f.label "Contatti" %><br>
            <%= f.text_area :contacts, :size => "90x5" %>
          </div>
          <div class="field">
            <%= f.label "Descrizione" %><br>
            <%= f.text_area :desc, :size => "90x5" %>
          </div>
          <div class="field">
            <%= f.label :email %><br>
            <%= f.text_field :email %>
          </div>
          <div class="field">
            <%= f.label "Istruzioni" %><br>
            <%= f.text_area :instructions, :size => "90x5" %>
          </div>
          <div class="field">
            <%= f.label :note %><br>
            <%= f.text_area :note, :size => "90x5" %>
          </div>
          <div class="field">
            <%= f.label :website %><br>
            <%= f.text_field :website, :size => "90" %>
          </div>
          <div class="field">
            <%= f.label "Immagine" %><br>
            <%= f.file_field :file %>
            <%= f.hidden_field :file_cache %>
          </div>
          <br />
          <div class="actions">
            <%= f.submit "Salva Esercizio", :class => "btn btn-primary" %>
          </div>
          <br />
        <% end %>

        </div>
        <div class="col-md-5">
            <div style="height:500px;width:500px;">
                <div id="map-canvas" style="width:100%; height:100%;"></div>
            </div>
        </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
<script>
  
  var geocoder;
  var map1;
  var marker;
  var input;
  var autocomplete;
  var latlng;

  function initialize() {
  	geocoder = new google.maps.Geocoder();
  	input = document.getElementById('<%= item %>_address');
  	autocomplete = new google.maps.places.Autocomplete(input);
  	google.maps.event.addListener(autocomplete, 'place_changed', function () {
  		var place = autocomplete.getPlace();
  		document.getElementById('<%= item %>_latitude').value = place.geometry.location.lat();
  		document.getElementById('<%= item %>_longitude').value = place.geometry.location.lng();
  		codeAddress();
  	});
  	var latlng = new google.maps.LatLng(46.0131725, 8.971465299999977);
  	var mapOptions = {
  		zoom: 16,
  		center: latlng,
  		mapTypeId: google.maps.MapTypeId.HYBRID,
        mapTypeControl: true,
        mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position: google.maps.ControlPosition.TOP_RIGHT
        },
        panControl: false,
        /*panControlOptions: {
            position: google.maps.ControlPosition.TOP_RIGHT
        },*/
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.LARGE,
            position: google.maps.ControlPosition.LEFT_TOP
        },
        scaleControl: false,
        /*scaleControlOptions: {
            position: google.maps.ControlPosition.TOP_LEFT
        },*/
        streetViewControl: false
        /*streetViewControlOptions: {
            position: google.maps.ControlPosition.LEFT_TOP
        }*/
  	}
  	map1 = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    if(document.getElementById('<%= item %>_latitude').val != "" || document.getElementById('<%= item %>_longitude').val != "") {
        codeLatLng();
    }
  }

  function codeAddress() {
  	var address = document.getElementById('<%= item %>_address').value;
  	geocoder.geocode( { 'address': address}, function(results, status) {
  		if (status == google.maps.GeocoderStatus.OK) {
  			map1.setCenter(results[0].geometry.location);
  			marker = new google.maps.Marker({
  				icon: {
  					url: 'http://mt.google.com/vt/icon?psize=16&font=fonts/Roboto-Regular.ttf&color=ff330000&name=icons/spotlight/spotlight-waypoint-b.png&ax=44&ay=50&text=1'
  				},
  				map: map1,
  				position: results[0].geometry.location,
  				draggable: true,
  				animation: google.maps.Animation.DROP
  			});
  			google.maps.event.addListener(marker, 'dragend', function (event) {
  				document.getElementById('<%= item %>_latitude').value = this.getPosition().lat();
  				document.getElementById('<%= item %>_longitude').value = this.getPosition().lng();
  			});
  		} else {
  			alert('Geocode was not successful for the following reason: ' + status);
  		}
  	});
  }
  
  function codeLatLng() {
      geocoder = new google.maps.Geocoder();
      var address = document.getElementById('<%= item %>_address').value;
      var Lat = document.getElementById('<%= item %>_latitude').value;
      var Long = document.getElementById('<%= item %>_longitude').value;
      latlng = new google.maps.LatLng(Lat, Long);
      marker = new google.maps.Marker({
	      icon: {
		      url: 'http://mt.google.com/vt/icon?psize=16&font=fonts/Roboto-Regular.ttf&color=ff330000&name=icons/spotlight/spotlight-waypoint-b.png&ax=44&ay=50&text=1'
	      },
          map: map1,
          position: latlng,
          draggable: true,
          animation: google.maps.Animation.DROP
      });
	google.maps.event.addListener(marker, 'dragend', function (event) {
		document.getElementById('<%= item %>_latitude').value = this.getPosition().lat();
		document.getElementById('<%= item %>_longitude').value = this.getPosition().lng();
	});
  
      map1.panTo(latlng);
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>